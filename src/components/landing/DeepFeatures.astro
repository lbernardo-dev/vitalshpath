---
import {
    Syringe,
    CalendarDays,
    Stethoscope,
    ArrowRight,
    Share2,
    Shield,
    HeartPulse,
    Info,
} from "lucide-react";
import { type Lang } from "../../i18n/ui-locales";
import { useTranslations } from "../../i18n";
import { Image } from "astro:assets";
import screenMedications from "../../assets/images/screens/screen-04-medications.PNG";
import screenMedicationDetail from "../../assets/images/screens/screen-05-medication-detail.PNG";
import screenWidgetsGallery from "../../assets/images/screens/screen-21-widgets-gallery.PNG";
import screenSymptoms from "../../assets/images/screens/screen-13-symptoms.PNG";
import screenSymptomGraph from "../../assets/images/screens/screen-14-symptom-graph.PNG";
import screenCalendarMonth from "../../assets/images/screens/screen-10-calendar-month.PNG";
import screenCalendarWeek from "../../assets/images/screens/screen-09-calendar-week.PNG";
import DeviceMockup from "../DeviceMockup.astro";

interface Props {
    lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<section
    id="deep-features"
    class="py-16 md:py-24 relative overflow-hidden bg-gray-50 dark:bg-gray-950"
>
    <div class="container mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-12 md:mb-20 md:mb-32 reveal">
            <span
                class="inline-block px-4 py-2 rounded-full bg-blue-500/10 text-blue-500 text-sm font-black mb-4 uppercase tracking-[0.2em]"
            >
                {t("deepFeatures.badge")}
            </span>
            <h2
                class="text-4xl md:text-6xl font-black text-gray-900 dark:text-white mb-6 tracking-tight italic"
            >
                {t("deepFeatures.title")}<br />
                <span
                    class="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent italic"
                >
                    {t("deepFeatures.titleHighlight")}
                </span>
            </h2>
        </div>

        <!-- 1. Architecture: List + Detail -->
        <div class="flex flex-col lg:flex-row items-center gap-20 mb-40">
            <div class="flex-1 order-2 lg:order-1 reveal">
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="w-14 h-14 rounded-2xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20"
                    >
                        <Syringe className="w-7 h-7 text-blue-600" />
                    </div>
                    <span
                        class="text-xs font-black text-blue-600 uppercase tracking-[0.3em]"
                        >{t("deepFeatures.medication.badge")}</span
                    >
                </div>
                <h3
                    class="text-3xl sm:text-4xl font-black text-gray-900 dark:text-white mb-6 uppercase tracking-tight italic"
                >
                    {t("deepFeatures.medication.title")}
                </h3>
                <p
                    class="text-gray-600 dark:text-gray-400 text-xl mb-10 leading-relaxed font-medium"
                >
                    {t("deepFeatures.medication.description")}
                </p>
                <ul class="space-y-6">
                    {
                        [0, 1, 2].map((i) => (
                            <li class="flex items-center gap-4 text-gray-900 dark:text-white group">
                                <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center shrink-0 border border-blue-500/20 group-hover:bg-blue-500 group-hover:text-white transition-all">
                                    <Share2 className="w-5 h-5" />
                                </div>
                                <span class="text-lg font-bold tracking-tight">
                                    {t(`deepFeatures.medication.features.${i}`)}
                                </span>
                            </li>
                        ))
                    }
                </ul>
            </div>

            <div
                class="flex-1 order-1 lg:order-2 flex justify-center perspective-[2000px] reveal-scale stagger-2 w-full h-[550px] lg:h-[650px]"
            >
                <div
                    class="relative group h-[672px] w-[310px] mockup-stack-container stack-2 transform scale-[0.8] lg:scale-[0.95] xl:scale-100 origin-top"
                >
                    <!-- Layer 2: Detail (Tilted Background) -->
                    <div
                        class="absolute left-16 top-10 transform -rotate-12 scale-95 opacity-40 group-hover:-rotate-15 group-hover:translate-x-12 group-hover:-translate-y-8 transition-all duration-700 stack-layer layer-back"
                    >
                        <DeviceMockup model="iphone15" showIsland={false}>
                            <Image
                                src={screenMedicationDetail}
                                alt="Medication Detail"
                                class="w-full h-full object-cover"
                                width={280}
                            />
                        </DeviceMockup>
                    </div>
                    <!-- Layer 1: List (Primary) -->
                    <div
                        class="absolute inset-0 transform z-10 scale-100 group-hover:scale-105 group-hover:rotate-2 transition-all duration-700 stack-layer layer-front"
                    >
                        <DeviceMockup model="iphone17" showIsland={false}>
                            <Image
                                src={screenMedications}
                                alt="Medication List"
                                class="w-full h-full object-cover"
                                width={320}
                            />
                        </DeviceMockup>
                    </div>
                    <!-- Liquid Glass Decorator -->
                    <div
                        class="absolute -right-12 -bottom-12 w-48 h-48 liquid-glass rounded-full blur-3xl -z-10 opacity-30"
                    >
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Calendar: Month + Week -->
        <div class="flex flex-col lg:flex-row items-center gap-20 mb-40">
            <div
                class="flex-1 flex justify-center perspective-[2000px] reveal-scale stagger-2 w-full h-[550px] lg:h-[650px]"
            >
                <div
                    class="relative group h-[672px] w-[310px] mockup-stack-container stack-2 transform scale-[0.8] lg:scale-[0.95] xl:scale-100 origin-top"
                >
                    <!-- Layer 2: Month View (Tilted Background) -->
                    <div
                        class="absolute -left-20 top-4 transform rotate-6 scale-90 opacity-40 group-hover:rotate-12 group-hover:-translate-x-16 transition-all duration-700 stack-layer layer-back"
                    >
                        <DeviceMockup model="iphone15" showIsland={false}>
                            <Image
                                src={screenCalendarMonth}
                                alt="Calendar Month"
                                class="w-full h-full object-cover"
                                width={260}
                            />
                        </DeviceMockup>
                    </div>
                    <!-- Layer 1: Week View (Primary/Front) -->
                    <div
                        class="absolute inset-x-0 -top-12 bottom-12 transform z-10 scale-100 group-hover:scale-105 group-hover:-rotate-2 transition-all duration-700 stack-layer layer-front"
                    >
                        <DeviceMockup model="iphone17" showIsland={false}>
                            <Image
                                src={screenCalendarWeek}
                                alt="Calendar Week"
                                class="w-full h-full object-cover"
                                width={320}
                            />
                        </DeviceMockup>
                    </div>
                </div>
            </div>

            <div class="flex-1 reveal lg:pt-20">
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="w-14 h-14 rounded-2xl bg-purple-500/10 flex items-center justify-center border border-purple-500/20"
                    >
                        <CalendarDays className="w-7 h-7 text-purple-600" />
                    </div>
                    <span
                        class="text-xs font-black text-purple-600 uppercase tracking-[0.3em]"
                        >{t("deepFeatures.calendar.badge")}</span
                    >
                </div>
                <h3
                    class="text-3xl sm:text-4xl font-black text-gray-900 dark:text-white mb-6 uppercase tracking-tight italic"
                >
                    {t("deepFeatures.calendar.title")}
                </h3>
                <p
                    class="text-gray-600 dark:text-gray-400 text-xl mb-10 leading-relaxed font-medium"
                >
                    {t("deepFeatures.calendar.description")}
                </p>
                <div class="grid grid-cols-1 gap-6">
                    {
                        [0, 1, 2].map((i) => (
                            <div class="flex items-start gap-4 p-5 rounded-2xl bg-white dark:bg-white/5 border border-gray-100 dark:border-white/10 shadow-sm hover:shadow-xl transition-all group backdrop-blur-sm">
                                <div class="w-8 h-8 rounded-lg bg-purple-500/10 flex items-center justify-center shrink-0 group-hover:bg-purple-500 group-hover:text-white transition-colors">
                                    <Shield className="w-4 h-4" />
                                </div>
                                <p class="text-sm font-bold text-gray-700 dark:text-gray-200">
                                    {t(`deepFeatures.calendar.features.${i}`)}
                                </p>
                            </div>
                        ))
                    }
                </div>
            </div>
        </div>

        <!-- 3. Health Audit: Symptoms + Graphs -->
        <div class="flex flex-col lg:flex-row items-center gap-20">
            <div class="flex-1 order-2 lg:order-1 reveal">
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="w-14 h-14 rounded-2xl bg-teal-500/10 flex items-center justify-center border border-teal-500/20"
                    >
                        <Stethoscope className="w-7 h-7 text-teal-600" />
                    </div>
                    <span
                        class="text-xs font-black text-teal-600 uppercase tracking-[0.3em]"
                        >{t("deepFeatures.symptoms.badge")}</span
                    >
                </div>
                <h3
                    class="text-3xl sm:text-4xl font-black text-gray-900 dark:text-white mb-6 uppercase tracking-tight italic"
                >
                    {t("deepFeatures.symptoms.title")}
                </h3>
                <p
                    class="text-gray-600 dark:text-gray-400 text-xl mb-10 leading-relaxed font-medium"
                >
                    {t("deepFeatures.symptoms.description")}
                </p>
                <ul class="space-y-4">
                    {
                        [0, 1, 2].map((i) => (
                            <li class="flex items-center gap-4 py-3 border-b border-gray-100 dark:border-white/5">
                                <HeartPulse className="w-5 h-5 text-teal-500" />
                                <span class="text-lg font-bold text-gray-800 dark:text-gray-100 uppercase tracking-tighter">
                                    {t(`deepFeatures.symptoms.features.${i}`)}
                                </span>
                            </li>
                        ))
                    }
                </ul>
                <div
                    class="mt-8 p-4 rounded-2xl bg-blue-500/5 border border-blue-500/10 flex items-start gap-3"
                >
                    <Info className="w-5 h-5 text-blue-500 shrink-0 mt-0.5" />
                    <p
                        class="text-[11px] text-blue-600/70 dark:text-blue-400/70 font-medium"
                    >
                        {t("notificationModes.hapticTip")}
                    </p>
                </div>
            </div>

            <div
                class="flex-1 order-1 lg:order-2 flex justify-center perspective-[2000px] reveal-scale stagger-2 w-full h-[550px] lg:h-[650px]"
            >
                <div
                    class="relative group h-[672px] w-[310px] mockup-stack-container stack-3 transform scale-[0.8] lg:scale-[0.95] xl:scale-100 origin-top"
                >
                    <!-- Layer 3: Wellness (Deep Background) -->
                    <div
                        class="absolute -right-16 -top-8 transform rotate-6 scale-75 opacity-20 group-hover:rotate-12 group-hover:translate-x-8 transition-all duration-1000 stack-layer layer-3"
                    >
                        <DeviceMockup model="iphone15" showIsland={false}>
                            <Image
                                src={screenWidgetsGallery}
                                alt="Widgets Gallery"
                                class="w-full h-full object-cover"
                                width={220}
                            />
                        </DeviceMockup>
                    </div>
                    <!-- Layer 2: Graphs -->
                    <div
                        class="absolute left-8 -bottom-4 transform -rotate-6 scale-90 opacity-40 group-hover:-rotate-12 group-hover:-translate-x-12 group-hover:translate-y-8 transition-all duration-700 stack-layer layer-2"
                    >
                        <DeviceMockup model="iphone15" showIsland={false}>
                            <Image
                                src={screenSymptomGraph}
                                alt="Symptom Graphs"
                                class="w-full h-full object-cover"
                                width={280}
                            />
                        </DeviceMockup>
                    </div>
                    <!-- Layer 1: Symptoms List -->
                    <div
                        class="absolute inset-0 transform z-10 scale-100 group-hover:scale-105 group-hover:translate-x-4 transition-all duration-700 stack-layer layer-1"
                    >
                        <DeviceMockup model="iphone17" showIsland={false}>
                            <Image
                                src={screenSymptoms}
                                alt="Symptoms List"
                                class="w-full h-full object-cover"
                                width={320}
                            />
                        </DeviceMockup>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-40 text-center reveal">
            <a
                href="#waitlist"
                class="inline-flex items-center gap-4 px-12 py-6 rounded-[2.5rem] bg-gray-900 dark:bg-white text-white dark:text-gray-900 font-black hover:scale-105 transition-all shadow-[0_20px_50px_rgba(0,0,0,0.2)] dark:shadow-[0_20px_50px_rgba(255,255,255,0.1)] uppercase tracking-[0.1em]"
            >
                <span>{t("waitlist.titleHighlight")}</span>
                <ArrowRight className="w-6 h-6" />
            </a>
        </div>
    </div>
</section>

<style>
    .mockup-stack-container {
        cursor: pointer;
    }

    .stack-layer {
        transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* Initial state for 2-layer stacks */
    .stack-2 .layer-back {
        z-index: 10;
        opacity: 0.4;
    }
    .stack-2 .layer-front {
        z-index: 20;
        opacity: 1;
    }

    /* Swapped state for 2-layer stacks */
    .stack-2.swapped .layer-back {
        z-index: 20;
        opacity: 1;
        transform: rotate(0deg) scale(1) translateX(0) translateY(0) !important;
    }
    .stack-2.swapped .layer-front {
        z-index: 10;
        opacity: 0.4;
        transform: rotate(-12deg) scale(0.9) translateX(40px) translateY(-20px) !important;
    }

    /* 3-layer stack logic */
    .stack-3 .layer-1 {
        z-index: 30;
        opacity: 1;
    }
    .stack-3 .layer-2 {
        z-index: 20;
        opacity: 0.5;
    }
    .stack-3 .layer-3 {
        z-index: 10;
        opacity: 0.2;
    }

    .stack-3.active-2 .layer-2 {
        z-index: 30;
        opacity: 1;
        transform: rotate(0deg) scale(1) translateX(0) translateY(0) !important;
    }
    .stack-3.active-2 .layer-1 {
        z-index: 20;
        opacity: 0.5;
        transform: rotate(6deg) scale(0.85) translateX(60px) translateY(-30px) !important;
    }
    .stack-3.active-2 .layer-3 {
        opacity: 0.2;
    }

    .stack-3.active-3 .layer-3 {
        z-index: 30;
        opacity: 1;
        transform: rotate(0deg) scale(1) translateX(0) translateY(0) !important;
    }
    .stack-3.active-3 .layer-1 {
        z-index: 10;
        opacity: 0.2;
        transform: rotate(-6deg) scale(0.8) translateX(-60px) translateY(30px) !important;
    }
    .stack-3.active-3 .layer-2 {
        z-index: 20;
        opacity: 0.5;
    }
</style>

<script>
    function setupStackInteraction() {
        const containers = document.querySelectorAll(".mockup-stack-container");

        containers.forEach((container) => {
            const layers = container.querySelectorAll(".stack-layer");

            container.addEventListener("click", () => {
                if (container.classList.contains("stack-2")) {
                    container.classList.toggle("swapped");
                } else if (container.classList.contains("stack-3")) {
                    if (container.classList.contains("active-2")) {
                        container.classList.remove("active-2");
                        container.classList.add("active-3");
                    } else if (container.classList.contains("active-3")) {
                        container.classList.remove("active-3");
                    } else {
                        container.classList.add("active-2");
                    }
                }
            });
        });
    }

    setupStackInteraction();
    document.addEventListener("astro:after-swap", setupStackInteraction);
</script>
