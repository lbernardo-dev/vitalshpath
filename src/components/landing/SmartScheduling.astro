---
import {
    Pill,
    Clock,
    ShieldCheck,
    Workflow,
    CalendarClock,
    ArrowRight,
    Sparkles,
    CheckCircle2,
    Tablet,
    Watch,
} from "lucide-react";
import { type Lang } from "../../i18n/ui-locales";
import { useTranslations } from "../../i18n";
import { Image } from "astro:assets";
import appIcon from "../../assets/images/Icon.png";

interface Props {
    lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const steps = [
    { id: 1, icon: Pill, color: "blue" },
    { id: 2, icon: Clock, color: "indigo" },
    { id: 3, icon: ShieldCheck, color: "purple" },
    { id: 4, icon: Workflow, color: "pink" },
    { id: 5, icon: CalendarClock, color: "green" },
];
---

<section
    id="smart-scheduler"
    class="py-16 md:py-24 relative overflow-hidden bg-white dark:bg-black"
>
    <!-- Background gradients -->
    <div class="absolute inset-0 pointer-events-none">
        <div
            class="absolute top-0 left-1/4 w-[500px] h-[500px] bg-blue-500/5 blur-[120px] rounded-full"
        >
        </div>
        <div
            class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-purple-500/5 blur-[120px] rounded-full"
        >
        </div>
    </div>

    <div class="container mx-auto px-6 relative z-10">
        <div class="text-center max-w-3xl mx-auto mb-12 md:mb-20 reveal">
            <div
                class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/10 border border-purple-500/20 mb-6 font-bold text-xs uppercase tracking-widest text-purple-500"
            >
                <Sparkles className="w-3 h-3" />
                {t("smartScheduling.badge")}
            </div>
            <h2
                class="text-4xl md:text-5xl font-black text-gray-900 dark:text-white mb-6 tracking-tight italic"
            >
                {t("smartScheduling.title")}
            </h2>
            <p class="text-xl text-gray-600 dark:text-gray-400">
                {t("smartScheduling.subtitle")}
            </p>
        </div>

        <!-- Main Flow Container -->
        <div class="max-w-6xl mx-auto">
            <!-- Steps Grid -->
            <div
                class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-16 md:mb-20 relative"
            >
                {/* Connecting Line */}
                <div
                    class="hidden md:block absolute top-[44px] left-[10%] right-[10%] h-[2px] bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-green-500/20 -z-10"
                >
                </div>

                {
                    steps.map((step, i) => (
                        <div
                            class={`reveal stagger-${
                                i + 1
                            } flex flex-col items-center text-center px-4`}
                        >
                            <div
                                class={`w-20 h-20 rounded-3xl bg-white dark:bg-gray-900 border-2 border-${step.color}-500/20 shadow-xl shadow-${step.color}-500/5 flex items-center justify-center mb-6 group hover:scale-110 transition-all duration-500 relative bg-clip-padding`}
                            >
                                <div
                                    class={`absolute inset-0 bg-${step.color}-500/5 rounded-3xl blur-[10px] opacity-0 group-hover:opacity-100 transition-opacity`}
                                />
                                <step.icon
                                    className={`w-10 h-10 text-${step.color}-500 relative z-10`}
                                />

                                {/* Step small number */}
                                <div class="absolute -top-2 -right-2 w-6 h-6 rounded-full bg-gray-900 dark:bg-white text-white dark:text-gray-900 text-[10px] font-black flex items-center justify-center shadow-lg">
                                    {step.id}
                                </div>
                            </div>
                            <h4 class="text-sm font-black text-gray-900 dark:text-white mb-2 uppercase tracking-wide">
                                {t(`smartScheduling.steps.${step.id}.title`)}
                            </h4>
                            <p class="text-[11px] text-gray-500 dark:text-gray-400 leading-normal">
                                {t(`smartScheduling.steps.${step.id}.desc`)}
                            </p>
                        </div>
                    ))
                }
            </div>

            <!-- Flow Simulation Box -->
            <div class="reveal reveal-scale stagger-5">
                <div
                    class="liquid-glass p-6 md:p-12 relative border-purple-500/20 w-full bg-gray-50/50 dark:bg-gray-900/30 overflow-hidden"
                >
                    <!-- Desktop Simulation Content (Hidden on Mobile) -->
                    <div
                        id="algo-sim-container-desktop"
                        class="hidden md:flex relative w-full h-[300px] items-center justify-between"
                    >
                        <!-- Animated Flow Paths (Moved to span full width) -->
                        <svg
                            class="absolute inset-x-0 top-0 w-full h-full pointer-events-none z-0 overflow-visible"
                            viewBox="0 0 1200 300"
                        >
                            <defs>
                                <filter
                                    id="glow-particle"
                                    x="-50%"
                                    y="-50%"
                                    width="200%"
                                    height="200%"
                                >
                                    <feGaussianBlur
                                        stdDeviation="3"
                                        result="blur"></feGaussianBlur>
                                    <feComposite
                                        in="SourceGraphic"
                                        in2="blur"
                                        operator="over"></feComposite>
                                </filter>
                            </defs>

                            <!-- Input A Path (From top-left icon to center) -->
                            <path
                                d="M 120 65 Q 350 65 600 150"
                                class="stroke-blue-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>
                            <!-- Input B Path (From bottom-left icon to center) -->
                            <path
                                d="M 120 235 Q 350 235 600 150"
                                class="stroke-indigo-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>
                            <!-- Output Path (From center to right cards) -->
                            <path
                                d="M 600 150 L 1080 150"
                                class="stroke-green-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>

                            <!-- Floating Data Particles -->
                            <circle
                                r="4"
                                fill="#3b82f6"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2.5s"
                                    repeatCount="indefinite"
                                    path="M 120 65 Q 350 65 600 150"
                                ></animateMotion>
                            </circle>
                            <circle
                                r="4"
                                fill="#6366f1"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2.5s"
                                    repeatCount="indefinite"
                                    begin="1.25s"
                                    path="M 120 235 Q 350 235 600 150"
                                ></animateMotion>
                            </circle>
                            <circle
                                r="5"
                                fill="#10b981"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2s"
                                    repeatCount="indefinite"
                                    begin="0.8s"
                                    path="M 600 150 L 1080 150"></animateMotion>
                            </circle>
                        </svg>

                        <!-- Left: Inputs (Particles) -->
                        <div
                            class="flex flex-col gap-16 items-center z-20 shrink-0"
                        >
                            <div class="group relative">
                                <div
                                    class="absolute inset-0 bg-blue-500/20 rounded-2xl blur-xl group-hover:bg-blue-500/40 transition-all duration-500"
                                >
                                </div>
                                <div
                                    class="w-16 h-16 rounded-2xl bg-white dark:bg-gray-900 border border-blue-500/20 flex items-center justify-center relative shadow-2xl transition-transform duration-500 group-hover:scale-110"
                                >
                                    <Pill className="w-8 h-8 text-blue-500" />
                                </div>
                                <div
                                    class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] font-black text-blue-500/60 uppercase tracking-widest whitespace-nowrap"
                                >
                                    Input A
                                </div>
                            </div>

                            <div class="group relative">
                                <div
                                    class="absolute inset-0 bg-indigo-500/20 rounded-2xl blur-xl group-hover:bg-indigo-500/40 transition-all duration-500"
                                    style="animation-delay: 1s;"
                                >
                                </div>
                                <div
                                    class="w-16 h-16 rounded-2xl bg-white dark:bg-gray-900 border border-indigo-500/20 flex items-center justify-center relative shadow-2xl transition-transform duration-500 group-hover:scale-110"
                                    style="transition-delay: 0.1s;"
                                >
                                    <Clock
                                        className="w-8 h-8 text-indigo-500"
                                    />
                                </div>
                                <div
                                    class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] font-black text-indigo-500/60 uppercase tracking-widest whitespace-nowrap"
                                >
                                    Input B
                                </div>
                            </div>
                        </div>

                        <!-- Center: The Silicon Core -->
                        <div
                            class="relative z-10 scale-110 lg:scale-125 shrink-0"
                        >
                            <!-- Processing Glow -->
                            <div
                                class="absolute inset-0 bg-purple-500/20 rounded-full blur-[80px] animate-pulse"
                            >
                            </div>

                            <!-- Device References (Floating) - Repositioned to avoid clipping -->
                            <div
                                class="absolute -top-16 -left-12 group/device opacity-40 hover:opacity-100 transition-opacity z-30"
                            >
                                <div
                                    class="px-2 py-1 rounded-lg bg-white/10 dark:bg-gray-900/40 backdrop-blur-md border border-white/10 shadow-xl flex items-center gap-1.5"
                                >
                                    <Tablet className="w-3 h-3 text-blue-400" />
                                    <span
                                        class="text-[7px] font-black uppercase text-gray-400 tracking-wider"
                                        >iPadOS</span
                                    >
                                </div>
                            </div>

                            <div
                                class="absolute -bottom-16 -right-12 group/device opacity-40 hover:opacity-100 transition-opacity z-30"
                            >
                                <div
                                    class="px-2 py-1 rounded-lg bg-white/10 dark:bg-gray-900/40 backdrop-blur-md border border-white/10 shadow-xl flex items-center gap-1.5"
                                >
                                    <Watch className="w-3 h-3 text-pink-400" />
                                    <span
                                        class="text-[7px] font-black uppercase text-gray-400 tracking-wider"
                                        >WatchOS</span
                                    >
                                </div>
                            </div>

                            <!-- Outer Rings (Silicon Circuits) -->
                            <div
                                class="relative w-64 h-64 flex items-center justify-center -m-8"
                            >
                                <svg
                                    class="absolute inset-0 w-full h-full rotate-animation"
                                >
                                    <circle
                                        cx="128"
                                        cy="128"
                                        r="120"
                                        fill="none"
                                        class="stroke-gray-200 dark:stroke-gray-800"
                                        stroke-width="1"></circle>
                                    <circle
                                        cx="128"
                                        cy="128"
                                        r="120"
                                        fill="none"
                                        class="stroke-purple-500/40"
                                        stroke-width="2"
                                        stroke-dasharray="10 200"
                                        stroke-linecap="round"></circle>
                                </svg>

                                <svg
                                    class="absolute inset-8 w-[calc(100%-64px)] h-[calc(100%-64px)] rotate-animation-reverse"
                                >
                                    <circle
                                        cx="96"
                                        cy="96"
                                        r="90"
                                        fill="none"
                                        class="stroke-gray-200 dark:stroke-gray-800"
                                        stroke-width="1"></circle>
                                    <circle
                                        cx="96"
                                        cy="96"
                                        r="90"
                                        fill="none"
                                        class="stroke-pink-500/40"
                                        stroke-width="2"
                                        stroke-dasharray="20 180"
                                        stroke-linecap="round"></circle>
                                </svg>

                                <!-- The Chip -->
                                <div class="relative z-20 group">
                                    <!-- Chip Glow -->
                                    <div
                                        class="absolute -inset-4 bg-gradient-to-br from-purple-600 to-pink-600 rounded-[2rem] opacity-20 blur-2xl group-hover:opacity-40 transition-opacity duration-500"
                                    >
                                    </div>

                                    <!-- Main Body -->
                                    <div
                                        class="w-28 h-28 bg-gradient-to-br from-gray-900 via-purple-950 to-black rounded-[2rem] border-2 border-white/10 shadow-3xl flex items-center justify-center relative overflow-hidden ring-1 ring-purple-500/30"
                                    >
                                        <!-- Circuit Grid Pattern -->
                                        <div
                                            class="absolute inset-0 opacity-20"
                                            style="background-image: radial-gradient(white 0.5px, transparent 0.5px); background-size: 8px 8px;"
                                        >
                                        </div>

                                        <!-- Central Icon (VitalsPath) -->
                                        <Image
                                            src={appIcon}
                                            alt="VitalsPath Core"
                                            class="w-14 h-14 relative z-10 animate-pulse rounded-2xl"
                                        />

                                        <!-- Energy Pulses -->
                                        <div
                                            class="absolute inset-0 bg-gradient-to-t from-purple-500/20 to-transparent animate-energy-flow"
                                        >
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Processing Paths & Ramifications (Veins - Internal Only) -->
                            <svg
                                class="absolute inset-[-60px] w-[calc(100%+120px)] h-[calc(100%+120px)] pointer-events-none overflow-visible z-0"
                                viewBox="0 0 400 400"
                            >
                                <g
                                    class="stroke-purple-500/30 stroke-[1] fill-none"
                                >
                                    <path
                                        d="M 200 200 L 250 120 L 320 100"
                                        class="animate-vein"></path>
                                    <path
                                        d="M 200 200 L 250 280 L 320 300"
                                        class="animate-vein"
                                        style="animation-delay: 0.5s"></path>
                                    <path
                                        d="M 200 200 L 150 120 L 80 100"
                                        class="animate-vein"
                                        style="animation-delay: 1s"></path>
                                    <path
                                        d="M 200 200 L 150 280 L 80 300"
                                        class="animate-vein"
                                        style="animation-delay: 1.5s"></path>
                                </g>
                            </svg>
                        </div>

                        <!-- Right: Output (Optimized Slots) -->
                        <div class="flex flex-col gap-4 z-20 shrink-0">
                            {
                                [1, 2, 3].map((i) => (
                                    <div
                                        class={`w-44 p-3 rounded-2xl liquid-glass border-green-500/20 shadow-2xl flex items-center gap-3 animate-slide-in-right opacity-0 transition-transform hover:scale-105 duration-300`}
                                        style={`animation-delay: ${
                                            1 + i * 0.4
                                        }s; animation-fill-mode: forwards;`}
                                    >
                                        <div class="w-8 h-8 rounded-xl bg-green-500/10 flex items-center justify-center shrink-0">
                                            <CheckCircle2 className="w-4 h-4 text-green-500" />
                                        </div>
                                        <div class="flex-1 space-y-1.5">
                                            <div class="w-full h-2 rounded-full bg-gray-200/50 dark:bg-gray-700/50 overflow-hidden relative">
                                                <div class="absolute inset-0 bg-green-500/40 animate-progress-flow" />
                                            </div>
                                            <div class="w-1/2 h-1.5 rounded-full bg-gray-100/30 dark:bg-gray-800/30" />
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>

                    <!-- Mobile Simulation Content (Vertical Layout - Absolute Positioning) -->
                    <div
                        id="algo-sim-container-mobile"
                        class="block md:hidden relative w-full h-[600px] max-w-[320px] mx-auto mt-4"
                    >
                        <!-- Vertical Flow Paths SVG -->
                        <svg
                            class="absolute inset-0 w-full h-full pointer-events-none z-0 overflow-visible"
                            viewBox="0 0 320 600"
                        >
                            <!-- Input A Path (Left to center down) -->
                            <path
                                d="M 68 68 Q 68 180 160 260"
                                class="stroke-blue-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>
                            <!-- Input B Path (Right to center down) -->
                            <path
                                d="M 252 68 Q 252 180 160 260"
                                class="stroke-indigo-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>
                            <!-- Output Path (Center down to bottom) -->
                            <path
                                d="M 160 260 L 160 540"
                                class="stroke-green-500/40 stroke-[3] fill-none"
                                stroke-linecap="round"></path>

                            <!-- Vertical Particles -->
                            <circle
                                r="4"
                                fill="#3b82f6"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2.5s"
                                    repeatCount="indefinite"
                                    path="M 68 68 Q 68 180 160 260"
                                ></animateMotion>
                            </circle>
                            <circle
                                r="4"
                                fill="#6366f1"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2.5s"
                                    repeatCount="indefinite"
                                    begin="1.25s"
                                    path="M 252 68 Q 252 180 160 260"
                                ></animateMotion>
                            </circle>
                            <circle
                                r="5"
                                fill="#10b981"
                                filter="url(#glow-particle)"
                            >
                                <animateMotion
                                    dur="2s"
                                    repeatCount="indefinite"
                                    begin="0.8s"
                                    path="M 160 260 L 160 540"></animateMotion>
                            </circle>
                        </svg>

                        <!-- Input A -->
                        <div class="group absolute top-[40px] left-[40px] z-20">
                            <div
                                class="w-14 h-14 rounded-2xl bg-white dark:bg-gray-900 border border-blue-500/20 flex items-center justify-center shadow-xl"
                            >
                                <Pill className="w-6 h-6 text-blue-500" />
                            </div>
                            <div
                                class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-[9px] font-black text-blue-500/60 uppercase tracking-widest whitespace-nowrap"
                            >
                                Input A
                            </div>
                        </div>

                        <!-- Input B -->
                        <div
                            class="group absolute top-[40px] right-[40px] z-20"
                        >
                            <div
                                class="w-14 h-14 rounded-2xl bg-white dark:bg-gray-900 border border-indigo-500/20 flex items-center justify-center shadow-xl"
                            >
                                <Clock className="w-6 h-6 text-indigo-500" />
                            </div>
                            <div
                                class="absolute -bottom-5 left-1/2 -translate-x-1/2 text-[9px] font-black text-indigo-500/60 uppercase tracking-widest whitespace-nowrap"
                            >
                                Input B
                            </div>
                        </div>

                        <!-- Mobile Center: The Silicon Core -->
                        <div
                            class="absolute top-[260px] left-[160px] -translate-x-1/2 -translate-y-1/2 z-10 w-40 h-40 flex items-center justify-center"
                        >
                            <div
                                class="absolute inset-0 bg-purple-500/20 rounded-full blur-[60px] animate-pulse"
                            >
                            </div>

                            <svg
                                class="absolute inset-0 w-full h-full rotate-animation"
                            >
                                <circle
                                    cx="80"
                                    cy="80"
                                    r="76"
                                    fill="none"
                                    class="stroke-gray-200 dark:stroke-gray-800"
                                    stroke-width="1"></circle>
                                <circle
                                    cx="80"
                                    cy="80"
                                    r="76"
                                    fill="none"
                                    class="stroke-purple-500/40"
                                    stroke-width="2"
                                    stroke-dasharray="10 150"
                                    stroke-linecap="round"></circle>
                            </svg>

                            <div class="relative z-20">
                                <div
                                    class="w-20 h-20 bg-gradient-to-br from-gray-900 via-purple-950 to-black rounded-[1.5rem] border-2 border-white/10 shadow-3xl flex items-center justify-center relative overflow-hidden ring-1 ring-purple-500/30"
                                >
                                    <Image
                                        src={appIcon}
                                        alt="VitalsPath Core"
                                        class="w-10 h-10 relative z-10 animate-pulse rounded-2xl"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- Mobile Bottom: Outputs -->
                        <div
                            class="absolute top-[400px] left-[160px] -translate-x-1/2 flex flex-col gap-3 w-[220px] z-20"
                        >
                            {
                                [1, 2, 3].map((i) => (
                                    <div class="w-full p-2.5 rounded-xl liquid-glass border-green-500/20 shadow-lg flex items-center gap-3">
                                        <div class="w-6 h-6 rounded-lg bg-green-500/10 flex items-center justify-center shrink-0">
                                            <CheckCircle2 className="w-3 h-3 text-green-500" />
                                        </div>
                                        <div class="flex-1 space-y-1.5">
                                            <div class="w-full h-1.5 rounded-full bg-gray-200/50 dark:bg-gray-700/50 relative overflow-hidden">
                                                <div class="absolute inset-0 bg-green-500/40 animate-progress-flow" />
                                            </div>
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .rotate-animation {
        animation: rotate 20s linear infinite;
    }
    .rotate-animation-reverse {
        animation: rotate 15s linear infinite reverse;
    }
    @keyframes rotate {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    @keyframes energy-flow {
        0%,
        100% {
            opacity: 0.1;
            transform: translateY(100%);
        }
        50% {
            opacity: 0.3;
            transform: translateY(-100%);
        }
    }
    .animate-energy-flow {
        animation: energy-flow 3s ease-in-out infinite;
    }
    @keyframes progress-flow {
        0% {
            transform: translateX(-100%);
        }
        100% {
            transform: translateX(100%);
        }
    }
    .animate-progress-flow {
        animation: progress-flow 2s linear infinite;
    }
    .shadow-3xl {
        box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.5);
    }

    @keyframes slide-in-right {
        from {
            transform: translateX(30px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    .animate-slide-in-right {
        animation: slide-in-right 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes line-vein {
        0% {
            stroke-dashoffset: 200;
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            stroke-dashoffset: 0;
            opacity: 0;
        }
    }
    .animate-vein {
        stroke-dasharray: 100 100;
        animation: line-vein 4s linear infinite;
    }
</style>
