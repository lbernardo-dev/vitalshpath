---
import { Heart, Mail, Twitter } from "lucide-react";
import { type Lang } from "../i18n/ui-locales";
import { useTranslations } from "../i18n";

interface Props {
    lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<footer class="py-10 border-t border-gray-200 dark:border-gray-800">
    <div class="container mx-auto px-6">
        <div
            class="flex flex-col md:flex-row justify-between items-center gap-6"
        >
            <div class="flex items-center gap-2">
                <img
                    src={`${import.meta.env.BASE_URL}/assets/images/Icon.png`}
                    alt="VitalsPath Logo"
                    class="w-8 h-8 rounded-lg"
                />
                <span class="text-base font-bold text-gray-900 dark:text-white"
                    >VitalsPath</span
                >
            </div>

            <div
                class="flex flex-wrap justify-center gap-6 text-sm text-gray-600 dark:text-gray-400"
            >
                <a
                    href={`${import.meta.env.BASE_URL}/${lang}/feedback`}
                    class="hover:text-gray-900 dark:hover:text-white transition-colors"
                    >{t("footer.feedback")}</a
                >
                <a
                    href={`${import.meta.env.BASE_URL}/${lang}/subscription`}
                    class="hover:text-gray-900 dark:hover:text-white transition-colors"
                    >{t("footer.subscription")}</a
                >
                <a
                    href={`${import.meta.env.BASE_URL}/${lang}/terms`}
                    class="hover:text-gray-900 dark:hover:text-white transition-colors"
                    >{t("footer.terms")}</a
                >
                <a
                    href={`${import.meta.env.BASE_URL}/${lang}/privacy`}
                    class="hover:text-gray-900 dark:hover:text-white transition-colors"
                    >{t("footer.privacy")}</a
                >
                <a
                    href={`${import.meta.env.BASE_URL}/${lang}/disclaimer`}
                    class="hover:text-gray-900 dark:hover:text-white transition-colors"
                    >{t("footer.disclaimer")}</a
                >
            </div>

            <div class="flex gap-3">
                <a
                    href="#"
                    class="w-9 h-9 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-400 hover:text-blue-500 transition-colors"
                >
                    <Twitter className="w-4 h-4" />
                </a>
                <a
                    href="mailto:vitalspath@gmail.com"
                    class="w-9 h-9 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-400 hover:text-blue-500 transition-colors"
                >
                    <Mail className="w-4 h-4" />
                </a>
            </div>
        </div>

        <div
            class="mt-8 pt-8 border-t border-gray-200 dark:border-gray-800 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-500 dark:text-gray-500"
        >
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2">
                    <span
                        class="w-2 h-2 rounded-full bg-green-500 animate-pulse"
                    ></span>
                    <span id="stats-users">Loading...</span>
                </div>
                <div class="hidden sm:flex items-center gap-2">
                    <span id="stats-regions">Loading...</span>
                </div>
                <div class="hidden sm:flex items-center gap-2">
                    <span id="stats-plans">Loading...</span>
                </div>
            </div>

            <p>
                &copy; {t("footer.copyright")}
                <Heart
                    className="w-3 h-3 text-red-500 inline fill-current animate-pulse ml-1"
                />
            </p>
        </div>
    </div>
</footer>

<script>
    function updateStats() {
        // Simple persistence simulation
        const STORAGE_KEY = "vitalspath_stats";
        let stats = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null");

        if (!stats) {
            stats = {
                users: 14250,
                plans: 5800,
                lastUpdate: Date.now(),
            };
        } else {
            // Increment slightly on each visit if enough time passed
            const now = Date.now();
            if (now - stats.lastUpdate > 60000) {
                // 1 minute
                stats.users += Math.floor(Math.random() * 3) + 1;
                stats.plans += Math.floor(Math.random() * 2);
                stats.lastUpdate = now;
            }
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));

        // Format numbers
        const fmt = new Intl.NumberFormat();

        const usersEl = document.getElementById("stats-users");
        const plansEl = document.getElementById("stats-plans");
        const regionsEl = document.getElementById("stats-regions");

        if (usersEl)
            usersEl.textContent = `${fmt.format(stats.users)} Active Users`;
        if (plansEl)
            plansEl.textContent = `${fmt.format(stats.plans)} Plans Created`;

        // Detect region
        try {
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const region = timeZone.split("/")[0] || "Global";
            if (regionsEl) regionsEl.textContent = `${region} Region`;
        } catch (e) {
            if (regionsEl) regionsEl.textContent = "Global Region";
        }
    }

    // Run on load
    document.addEventListener("DOMContentLoaded", updateStats);
    // document.addEventListener('astro:page-load', updateStats); // If using view transitions
</script>
